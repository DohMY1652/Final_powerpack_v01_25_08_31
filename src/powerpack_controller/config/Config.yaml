# [MODIFIED] Added 'pp_controller:' as the top-level key and indented all content.
pp_controller:
  ros__parameters:
    active_mpc_channels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
    sensor_filter_alpha: 0.01


    # === per-channel calibration (map-based) ===
    Sensor_calibration:
      atm_offset: 101.325
      b0:
        "0": { offset: 1007.0,  gain: 0.250 }
        "1": { offset: 996.0,  gain: 0.250 }
        "2": { offset: 1001.0,  gain: 0.250 }
        "3": { offset: 1026.0,  gain: 0.250 }
      b1:
        "0": { offset: 981.0,  gain: 0.250 }
        "1": { offset: 1004.0,  gain: 0.250 }
        "2": { offset: 950.0,  gain: -0.02525 }
        "3": { offset: 952.0,  gain: -0.02525 }
      b2:
        "0": { offset: 934.0,  gain: -0.02525 }
        "1": { offset: 948.0,  gain: -0.02525 }
        "2": { offset: 958.0,  gain: -0.02525 }
        "3": { offset: 958.0,  gain: -0.02525 }
        "4": { offset: 666.0,  gain: 0.3150 }   # pos line (í•€20)
        "5": { offset: 655.0,  gain: -0.0378 }  # neg line (í•€21)
        "6": { offset: 402.0,  gain: 0.6800 }   # macro line (í•€22)

    RefTcp:
      enable: true
      host: "169.254.46.254"  # ğŸ‘ˆ íŒŒì´ì¬ ì½”ë“œê°€ ì ‘ì†í•˜ë˜ ì„œë²„ IP
      # host: "127.0.0.1"       # ğŸ‘ˆ "169.254.46.254" ëŒ€ì‹  "127.0.0.1" (localhost)ë¡œ ë³€ê²½
      port: 2274           # ğŸ‘ˆ íŒŒì´ì¬ ì½”ë“œê°€ ì ‘ì†í•˜ë˜ ì„œë²„ í¬íŠ¸
      expect_n: 12
      scale: 0.01             # ğŸ‘ˆ ìŠ¤ì¼€ì¼ (ì˜ˆ: 10132 -> 101.32)

    LinePID:
      pos:
        kp: 4.0
        ki: 1.0
        kd: 0.0
        ref: 400.0
        pwm_index: 12
      # ì£¼ì˜: í˜„ì¬ ì½”ë“œì—” neg PID ì‚¬ìš© ì•ˆ í•¨(ë¬´ì‹œë¨)

      # [ì¶”ê°€ë¨] ìŒì•• ë¼ì¸ PID ì„¤ì •
      neg:
        kp: 0.8      # ì˜ˆì‹œê°’, ì‹¤ì œ ì‹œìŠ¤í…œì— ë§ê²Œ íŠœë‹ í•„ìš”
        ki: 0.2      # ì˜ˆì‹œê°’, ì‹¤ì œ ì‹œìŠ¤í…œì— ë§ê²Œ íŠœë‹ í•„ìš”
        kd: 0.0      # ì˜ˆì‹œê°’, ì‹¤ì œ ì‹œìŠ¤í…œì— ë§ê²Œ íŠœë‹ í•„ìš”
        ref: 40.0      # ëª©í‘œ ìŒì••(ì ˆëŒ€ì•• ê¸°ì¤€), ì˜ˆì‹œê°’
        pwm_index: 13  # ë³´ë“œ2ì˜ 14ë²ˆì§¸ PWM ì±„ë„
      out_min: 0.0
      out_max: 100.0

    Reference_parameters:
      frequency: 1000

    PWM_parameters:
      frequency: 1000
      pid_pos_index: 18
      pid_neg_index: 19

    MPC_parameters:
      NP: 5
      n_x: 1
      n_u: 3
      Ts: 0.004
      Q_values: 20.0
      R_values: 0.1
      pos_ku_micro: 0.5
      pos_ku_macro: 0.1
      pos_ku_atm: 2.0
      neg_ku_micro: 0.5
      neg_ku_macro: 0.05
      neg_ku_atm: 3.0

      # --- ìƒˆë¡œ ì¶”ê°€í•  I ê²Œì¸ (ki) ---
  # ì²˜ìŒì—ëŠ” ì‘ì€ ê°’ìœ¼ë¡œ ì‹œì‘í•˜ì—¬ íŠœë‹í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
      pos_ki_micro: 0.5
      pos_ki_macro: 0.05
      pos_ki_atm: 0.5
      neg_ki_micro: 0.4
      neg_ki_macro: 0.05
      neg_ki_atm: 0.5
      
      # [ì¶”ê°€ë¨] Macro ë°¸ë¸Œ ì‚¬ìš©ëŸ‰ì„ ì¤„ì´ê¸° ìœ„í•œ ê²Œì¸ ìŠ¹ìˆ˜ (0.0 ~ 1.0 ì‚¬ì´ ê°’ ê¶Œì¥)
      macro_gain_multiplier: 1.0



    # ROBOTORY chamber volume
    channel_volume:
      #positive
      ch0_ml: 1000 # SORO
      ch1_ml: 1000 # SORO
      ch2_ml: 300 # SORO
      ch3_ml: 300 # SORO
      ch4_ml: 600 # CAMAS
      ch5_ml: 600 # CAMAS
      #negative
      ch6_ml: 1000 # SORO
      ch7_ml: 1000 # SORO 
      ch8_ml: 300 # SORO
      ch9_ml: 300 # SORO
      ch10_ml: 0
      ch11_ml: 0 
# Fianl channel : Positive 8, negtaive 4

  # # channel_volume:
  #     #positive
  #     ch0_ml: 0
  #     ch1_ml: 0
  #     ch2_ml: 0
  #     ch3_ml: 0
  #     ch4_ml: 1000
  #     ch5_ml: 0
  #     #negative
  #     ch6_ml: 0
  #     ch7_ml: 0
  #     ch8_ml: 0
  #     ch9_ml: 0
  #     ch10_ml: 0 
  #     ch11_ml: 0 

# ROBOTORY chamber volume
    # channel_volume:
    #   #positive
    #   ch0_ml: 50
    #   ch1_ml: 50
    #   ch2_ml: 50
    #   ch3_ml: 50
    #   ch4_ml: 50
    #   ch5_ml: 50
    #   #negative
    #   ch6_ml: 50
    #   ch7_ml: 50
    #   ch8_ml: 50
    #   ch9_ml: 50
    #   ch10_ml: 50
    #   ch11_ml: 50

    system_parameters:
      sensor_print: false
      reference_print: false
      pwm_print: false
      valve_operate: true

    MacroSwitch:
      threshold_kpa: 600.0

      # robotory rio ip : 169.254.46.254
      # current port : 2279